(function(e){function t(t){for(var a,r,o=t[0],c=t[1],u=t[2],g=0,f=[];g<o.length;g++)r=o[g],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&f.push(n[r][0]),n[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);l&&l(t);while(f.length)f.shift()();return i.push.apply(i,u||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],a=!0,o=1;o<s.length;o++){var c=s[o];0!==n[c]&&(a=!1)}a&&(i.splice(t--,1),e=r(r.s=s[0]))}return e}var a={},n={app:0},i=[];function r(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=a,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(s,a,function(t){return e[t]}.bind(null,a));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/web/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=c;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("cd49")},1625:function(e,t,s){"use strict";s("7812")},"1b9e":function(e,t,s){},2382:function(e,t,s){"use strict";s("5e91")},"474d":function(e,t,s){"use strict";s("4f57")},"4f57":function(e,t,s){},"5e91":function(e,t,s){},7812:function(e,t,s){},"7ab6":function(e,t,s){"use strict";s("bbb6")},af80:function(e,t,s){"use strict";s("1b9e")},bbb6:function(e,t,s){},cd49:function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var a=s("2b0e"),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("router-view",{staticClass:"views"})],1)},i=[],r=a["default"].extend({name:"App",data:function(){return{title:"Test"}},sockets:{connect:function(){console.log("SocketIO connect success."),this.$notify({title:"SocketIO",message:"SocketIO connect success."})},connect_error:function(e){console.log("SocketIO connect fail. Failure message:"+e),this.$notify.error({title:"SocketIO connect failure",message:e})}}}),o=r,c=(s("7ab6"),s("2877")),u=Object(c["a"])(o,n,i,!1,null,"6f96668a",null),l=u.exports,g=s("9483");Object(g["a"])("".concat("/web/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var f=s("8c4f"),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"wrapper"},[s("el-container",[s("el-aside",{attrs:{width:"250px"}},[s("el-header",{attrs:{height:"40px"}},[s("i",{staticClass:"el-icon-user-solid icon-message"}),s("span",{staticClass:"title"},[e._v("聊天列表")])]),s("ChatList")],1),s("el-main",[s("el-header",{attrs:{height:"40px"}},[s("span",{staticClass:"title"},[e._v(e._s(e.getActivingTitle))])]),s("Messages"),s("Sender")],1)],1)],1)},m=[],p=s("d4ec"),h=s("bee2"),v=s("45eb"),b=s("7e84"),_=s("262e"),y=s("2caf"),w=s("9ab4"),k=s("1b40"),C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"messages-box"},[s("ul",{staticClass:"messages-ul-box"},e._l(e.getMessages,(function(t,a){return s("li",{key:a,class:e.isSelf(t.user_id)},[s("img",{staticClass:"message-avatar",attrs:{src:e.avatar(t.sender.user_id),alt:t.sender.nickname?t.sender.nickname:t.self_id}}),""===t.nickname?s("p",{staticClass:"message-nickname"},[e._v(" "+e._s(e.formatTime(t.time))+" ")]):s("p",{staticClass:"message-nickname"},[e._v(" "+e._s(t.sender.nickname+" "+e.formatTime(t.time))+" ")]),s("p",{staticClass:"message-classic",domProps:{innerHTML:e._s(e.build_message(t))}})])})),0)])},O=[];s("d3b7"),s("25f0"),s("ac1f"),s("5319"),s("fb6a");function j(e){for(var t="",s=0;s<e.length;s++)t+=x(e[s]);return t}function x(e){var t="",s="";switch(e.type){case"text":t=e.data.text;break;case"image":e.data.url?(s=e.data.url,t='<img style="max-width:100%" src="/web/img?url='+encodeURIComponent(s)+'">'):e.data.file&&("base64://"===e.data.file.slice(0,9)?t='<img style="max-width:100%" src="data:image/jpg;base64,'+e.data.file.slice(9)+'"/>':"http"===e.data.file.slice(0,4)?(s=e.data.file,t='<img style="max-width:100%" src="'+s+'">'):t=JSON.stringify(e));break;case"at":t='<span style="color:#377ec8"> @'+e.data.qq+" </span>";break;default:t=JSON.stringify(e)}return console.log(t),t}var M=j,S=function(e){Object(_["a"])(s,e);var t=Object(y["a"])(s);function s(){return Object(p["a"])(this,s),t.apply(this,arguments)}return Object(h["a"])(s,[{key:"getChat",get:function(){return this.$store.getters.activingChat}},{key:"build_message",value:function(e){if(e.message){var t="";return e.to_me&&"group"===e.message_type&&(t+='<span style="color:red"> @'+this.$store.state.envs.bot_id+" </span>"),t+=M(e.message),t}return this.escape(e.raw_message)}},{key:"getMessages",get:function(){return console.log(this.$store.getters.activingChat.messages),this.$store.getters.activingChat.messages}},{key:"avatar",value:function(e){return 0===e?"https://v2.nonebot.dev/logo.png":"http://q1.qlogo.cn/g?b=qq&nk="+e.toString()+"&s=640"}},{key:"isSelf",value:function(e){return 0===this.$store.state.activingChatNumber?e===this.$store.state.envs.self_id?"rightmsg":"leftmsg":e===this.$store.state.envs.bot_id?"rightmsg":"leftmsg"}},{key:"escape",value:function(e){return e.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}},{key:"formatTime",value:function(e){var t,s=new Date(e),a=s.getHours(),n=s.getMinutes(),i="";return t=a<10?"0".concat(a):a.toString(),i=n<10?"0".concat(n):n.toString(),t+":"+i}}]),s}(k["b"]);S=Object(w["a"])([Object(k["a"])({name:"Messages"})],S);var $=S,N=$,T=(s("1625"),Object(c["a"])(N,C,O,!1,null,"c07699e4",null)),A=T.exports,B=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sender"},[s("div",{staticClass:"input-tools"},[s("i",{staticClass:"el-icon-s-opportunity",attrs:{slot:"reference",title:"表情"},slot:"reference"})]),s("el-input",{attrs:{type:"textarea",resize:"none",autosize:{minRows:3,maxRows:3}},nativeOn:{keyup:function(t){return e.keyUp.apply(null,arguments)}},model:{value:e.textArea,callback:function(t){e.textArea=t},expression:"textArea"}}),s("div",{staticClass:"footer-tools"},[s("el-button",{staticClass:"send-button",attrs:{size:"mini",type:"primary"},on:{click:e.sendMessage}},[e._v(" 连接 ")])],1)],1)},E=[],q=(s("a9e3"),function(e){Object(_["a"])(s,e);var t=Object(y["a"])(s);function s(){var e;return Object(p["a"])(this,s),e=t.apply(this,arguments),e.textArea="",e}return Object(h["a"])(s,[{key:"buildMessage",value:function(){var e,t=this.$store.getters.activingChat;e="private"==t.type?"private":"group";var s={user_id:t.user_id,message_type:e,raw_message:this.textArea,self_id:this.$store.state.self_id,post_type:"message",time:0};return s}},{key:"sendMessage",value:function(){var e=this,t=Number(this.textArea);this.textArea="",isNaN(t)?this.$notify.warning("请输入合法的Bot_id"):this.$socket.emit("config",{type:"setBot_id",bot_id:t},(function(s){e.$store.commit("setBot_id",t),console.log(s),e.$notify.info("已连接到Room："+t.toString())}))}},{key:"keyUp",value:function(e){"Enter"===e.key&&(this.textArea=this.textArea.slice(0,-1),this.sendMessage())}}]),s}(k["b"]));q=Object(w["a"])([Object(k["a"])({name:"Sender"})],q);var P=q,H=P,I=(s("474d"),Object(c["a"])(H,B,E,!1,null,null,null)),D=I.exports,L=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",{staticClass:"message-item"},e._l(e.concats,(function(t,a){return s("li",{key:a,class:["message-list",{"message-active":t[1].active}],on:{click:function(s){return e.switchChat(t[0])}}},[s("div",{staticClass:"message-left"},[s("el-badge",{staticClass:"item",attrs:{max:99,value:t[1].newMessageCount,hidden:!t[1].hadNewMessage||!t[1].hadNewMessage}},[s("img",{staticClass:"message-avatar",attrs:{src:e.avatar(t[1].type,t[0])}})])],1),s("div",{staticClass:"message-right"},[s("div",{staticClass:"message-header"},[s("div",{staticClass:"message-title"},[e._v(" "+e._s(t[1].chatName)+" ")]),s("div",{staticClass:"message-time"},[e._v(" "+e._s(e.formatTime(t[1]))+" ")])]),s("div",{staticClass:"message-content",domProps:{innerHTML:e._s(e.newMessage(t[1]))}})])])})),0)},z=[],J=function(e){Object(_["a"])(s,e);var t=Object(y["a"])(s);function s(){return Object(p["a"])(this,s),t.apply(this,arguments)}return Object(h["a"])(s,[{key:"concats",get:function(){return this.$store.state.chats}},{key:"avatar",value:function(e,t){return 0===t?"https://v2.nonebot.dev/logo.png":"private"===e?"http://q1.qlogo.cn/g?b=qq&nk="+t.toString()+"&s=640":"http://p.qlogo.cn/gh/"+t+"/"+t+"/0"}},{key:"newMessage",value:function(e){return e.messages[e.messages.length-1]?e.messages[e.messages.length-1].raw_message:""}},{key:"switchChat",value:function(e){this.$store.commit("switchChat",e),this.$forceUpdate(),Object(v["a"])(Object(b["a"])(s.prototype),"$gotoBottom",this)}},{key:"formatTime",value:function(e){var t;if(!e.messages[0])return"-:-";t=e.messages[0].time;var s,a=new Date(t),n=a.getHours(),i=a.getMinutes(),r="";return s=n<10?"0".concat(n):n.toString(),r=i<10?"0".concat(i):i.toString(),s+":"+r}}]),s}(k["b"]);J=Object(w["a"])([Object(k["a"])({name:"ChatList"})],J);var R=J,U=R,F=(s("af80"),Object(c["a"])(U,L,z,!1,null,"163f6a7d",null)),K=F.exports,W=function(e){Object(_["a"])(s,e);var t=Object(y["a"])(s);function s(){return Object(p["a"])(this,s),t.apply(this,arguments)}return Object(h["a"])(s,[{key:"getActivingTitle",get:function(){return this.$store.getters.activingChat.chatName}},{key:"created",value:function(){Object(v["a"])(Object(b["a"])(s.prototype),"$socket",this).connect()}}]),s}(k["b"]);W=Object(w["a"])([Object(k["a"])({name:"Dialogue",components:{Messages:A,Sender:D,ChatList:K}})],W);var X=W,G=X,Q=(s("2382"),Object(c["a"])(G,d,m,!1,null,"2c96dcc7",null)),V=Q.exports,Y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"about"},[s("h1",{on:{click:e.toastr_test}},[e._v("This is an about page")])])},Z=[],ee=function(e){Object(_["a"])(s,e);var t=Object(y["a"])(s);function s(){return Object(p["a"])(this,s),t.apply(this,arguments)}return s}(k["b"]),te=ee,se=Object(c["a"])(te,Y,Z,!1,null,null,null),ae=se.exports;a["default"].use(f["a"]);var ne=[{path:"/",name:"Home",component:V},{path:"/about",name:"About",component:ae}],ie=new f["a"]({mode:"history",base:"/web/",routes:ne}),re=ie,oe=(s("4ec9"),s("3ca3"),s("ddb0"),s("99af"),s("a630"),s("2f62"));a["default"].use(oe["a"]);var ce={state:{envs:{self_id:-1,access_token:"",bot_id:-1},chats:new Map([[0,{user_id:0,active:!0,chatName:"NoneBotWeb",avatar:"https://v2.nonebot.dev/logo.png",type:"",messages:[{user_id:0,self_id:-1,post_type:"",message_type:"",raw_message:"本项目仅做技术讨论之用。\n本项目不具备任何发送消息功能。\n请在下方输入bot_id开始监听（视奸）",time:(new Date).getTime(),sender:{user_id:0,nickname:"NoneBotWeb",sex:"Bot",age:0}}],newMessageCount:0,hadNewMessage:!1}]]),activingChatNumber:0},getters:{activingChat:function(e){var t=e.chats.get(e.activingChatNumber);return void 0===t?(console.log("activingChat get error"),t):t}},mutations:{delAllChats:function(e){var t=e.chats.get(0);e.chats.clear(),e.chats.set(0,t)},setBot_id:function(e,t){e.envs.bot_id=t},delChat:function(e,t){e.chats.delete(t)},switchChat:function(e,t){var s=e.chats.get(t);if(s.hadNewMessage=!1,s.newMessageCount=0,s){s.active=!0,e.chats.set(t,s);var a=e.chats.get(e.activingChatNumber);a&&(a.active=!1,e.chats.set(e.activingChatNumber,a),e.activingChatNumber=t)}},checkChat:function(e,t){var s={user_id:t.id,active:!1,type:t.message_type,chatName:t.chatName,avatar:"",messages:[],newMessageCount:0,hadNewMessage:!1};e.chats.set(t.id,s)},newMessage:function(e,t){var s={message_type:t.message_type,raw_message:t.raw_message,message:t.message,user_id:t.user_id,time:t.time,self_id:t.self_id,post_type:t.post_type,to_me:t.to_me,sender:{user_id:t.sender.user_id,nickname:t.sender.nickname,sex:t.sender.sex,age:t.sender.age}},a=e.chats,n=a.get(t.id);n.messages.push(s),a.delete(t.id),n.active||(n.hadNewMessage=!0,n.newMessageCount+=1);var i=[[t.id,n]].concat(Array.from(a)),r=new Map(i);e.chats=new Map,e.chats=r}},actions:{SOCKET_event:function(e,t){var s=e.commit,a=e.rootState;a.chats.get(t.id)||s("checkChat",t),s("newMessage",t)}},modules:{}},ue=new oe["a"].Store(ce),le={install:function(e){Object.defineProperties(e.prototype,{$gotoBottom:{get:function(){var e=document.getElementsByClassName("messages-box")[0];this.$nextTick((function(){e.scrollTop=e.scrollHeight}))}},gotoBottom:{get:function(){var e=document.getElementsByClassName("messages-box")[0];this.$nextTick((function(){e.scrollTop=e.scrollHeight}))}}})}},ge=le,fe=s("5132"),de=s.n(fe),me=function(e){return a["default"].use(new de.a({debug:!1,connection:"/",vuex:{store:e,actionPrefix:"SOCKET_",mutationPrefix:"SOCKET_"},options:{path:"/web_ws/socket",autoConnect:!1,transportOptions:{polling:{extraHeaders:{Authorization:e.state.envs.access_token,"X-Self-ID":e.state.envs.self_id}}}}}))},pe=(s("0fae"),s("5c96")),he=s.n(pe);a["default"].use(ge),me(ue),a["default"].use(he.a),a["default"].config.productionTip=!1,new a["default"]({router:re,store:ue,render:function(e){return e(l)}}).$mount("#app")}});
//# sourceMappingURL=app.28fec41e.js.map
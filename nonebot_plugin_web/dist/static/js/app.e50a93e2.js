(function(e){function t(t){for(var a,o,r=t[0],c=t[1],u=t[2],g=0,f=[];g<r.length;g++)o=r[g],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&f.push(n[o][0]),n[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);l&&l(t);while(f.length)f.shift()();return i.push.apply(i,u||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],a=!0,r=1;r<s.length;r++){var c=s[r];0!==n[c]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=s[0]))}return e}var a={},n={app:0},i=[];function o(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=a,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(s,a,function(t){return e[t]}.bind(null,a));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/web/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var u=0;u<r.length;u++)t(r[u]);var l=c;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("cd49")},2382:function(e,t,s){"use strict";s("5e91")},"474d":function(e,t,s){"use strict";s("4f57")},"4f57":function(e,t,s){},"5e91":function(e,t,s){},"73c7":function(e,t,s){},7914:function(e,t,s){},"7ab6":function(e,t,s){"use strict";s("bbb6")},bbb6:function(e,t,s){},cd49:function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var a=s("2b0e"),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("router-view",{staticClass:"views"})],1)},i=[],o=a["default"].extend({name:"App",data:function(){return{title:"Test"}},sockets:{connect:function(){console.log("SocketIO connect success."),this.$notify({title:"SocketIO",message:"SocketIO connect success."})},connect_error:function(e){console.log("SocketIO connect fail. Failure message:"+e),this.$notify.error({title:"SocketIO connect failure",message:e})}}}),r=o,c=(s("7ab6"),s("2877")),u=Object(c["a"])(r,n,i,!1,null,"6f96668a",null),l=u.exports,g=s("9483");Object(g["a"])("".concat("/web/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var f=s("8c4f"),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"wrapper"},[s("el-container",[s("el-aside",{attrs:{width:"250px"}},[s("el-header",{attrs:{height:"40px"}},[s("i",{staticClass:"el-icon-user-solid icon-message"}),s("span",{staticClass:"title"},[e._v("聊天列表")])]),s("ChatList")],1),s("el-main",[s("el-header",{attrs:{height:"40px"}},[s("span",{staticClass:"title"},[e._v(e._s(e.getActivingTitle))])]),s("Messages"),s("Sender")],1)],1)],1)},p=[],h=s("d4ec"),m=s("bee2"),v=s("45eb"),b=s("7e84"),_=s("262e"),y=s("2caf"),w=s("9ab4"),C=s("1b40"),k=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"messages-box"},[s("ul",{staticClass:"messages-ul-box"},e._l(e.getMessages,(function(t,a){return s("li",{key:a,class:e.isSelf(t.user_id)},[s("img",{staticClass:"message-avatar",attrs:{src:e.avatar(t.sender.user_id),alt:t.sender.nickname?t.sender.nickname:t.self_id}}),""===t.nickname?s("p",{staticClass:"message-nickname"},[e._v(" "+e._s(e.formatTime(t.time))+" ")]):s("p",{staticClass:"message-nickname"},[e._v(" "+e._s(t.sender.nickname+" "+e.formatTime(t.time))+" ")]),s("p",{staticClass:"message-classic",domProps:{innerHTML:e._s(e.escape(t.raw_message))}})])})),0)])},O=[],j=(s("d3b7"),s("25f0"),s("ac1f"),s("5319"),function(e){Object(_["a"])(s,e);var t=Object(y["a"])(s);function s(){return Object(h["a"])(this,s),t.apply(this,arguments)}return Object(m["a"])(s,[{key:"getChat",get:function(){return this.$store.getters.activingChat}},{key:"getMessages",get:function(){return console.log(this.$store.getters.activingChat.messages),this.$store.getters.activingChat.messages}},{key:"avatar",value:function(e){return 0===e?"https://v2.nonebot.dev/logo.png":"http://q1.qlogo.cn/g?b=qq&nk="+e.toString()+"&s=640"}},{key:"isSelf",value:function(e){return 0===this.$store.state.activingChatNumber?e===this.$store.state.envs.self_id?"rightmsg":"leftmsg":e===this.$store.state.envs.bot_id?"rightmsg":"leftmsg"}},{key:"escape",value:function(e){return e.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}},{key:"formatTime",value:function(e){var t,s=new Date(e),a=s.getHours(),n=s.getMinutes(),i="";return t=a<10?"0".concat(a):a.toString(),i=n<10?"0".concat(n):n.toString(),t+":"+i}}]),s}(C["b"]));j=Object(w["a"])([Object(C["a"])({name:"Messages"})],j);var x=j,M=x,$=(s("fa6d"),Object(c["a"])(M,k,O,!1,null,"1604d599",null)),S=$.exports,N=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sender"},[s("div",{staticClass:"input-tools"},[s("i",{staticClass:"el-icon-s-opportunity",attrs:{slot:"reference",title:"表情"},slot:"reference"})]),s("el-input",{attrs:{type:"textarea",resize:"none",autosize:{minRows:3,maxRows:3}},nativeOn:{keyup:function(t){return e.keyUp.apply(null,arguments)}},model:{value:e.textArea,callback:function(t){e.textArea=t},expression:"textArea"}}),s("div",{staticClass:"footer-tools"},[s("el-button",{staticClass:"send-button",attrs:{size:"mini",type:"primary"},on:{click:e.sendMessage}},[e._v(" 发送 ")])],1)],1)},T=[],A=(s("a9e3"),function(e){Object(_["a"])(s,e);var t=Object(y["a"])(s);function s(){var e;return Object(h["a"])(this,s),e=t.apply(this,arguments),e.textArea="",e}return Object(m["a"])(s,[{key:"buildMessage",value:function(){var e,t=this.$store.getters.activingChat;e="private"==t.type?"private":"group";var s={user_id:t.user_id,message_type:e,raw_message:this.textArea,self_id:this.$store.state.self_id,post_type:"message",time:0};return s}},{key:"sendMessage",value:function(){var e=this,t=Number(this.textArea);this.textArea="",isNaN(t)?this.$notify.warning("请输入合法的Bot_id"):this.$socket.emit("config",{type:"setBot_id",bot_id:t},(function(s){e.$store.commit("setBot_id",t),console.log(s),e.$notify.info("已连接到Room："+t.toString())}))}},{key:"keyUp",value:function(e){"Enter"===e.ksy&&this.sendMessage()}}]),s}(C["b"]));A=Object(w["a"])([Object(C["a"])({name:"Sender"})],A);var B=A,E=B,P=(s("474d"),Object(c["a"])(E,N,T,!1,null,null,null)),q=P.exports,H=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",{staticClass:"message-item"},e._l(e.concats,(function(t,a){return s("li",{key:a,class:["message-list",{"message-active":t[1].active}],on:{click:function(s){return e.switchChat(t[0])}}},[s("div",{staticClass:"message-left"},[s("el-badge",{staticClass:"item",attrs:{max:99,value:t[1].newMessageCount,hidden:!t[1].hadNewMessage||!t[1].hadNewMessage}},[s("img",{staticClass:"message-avatar",attrs:{src:e.avatar(t[1].type,t[0])}})])],1),s("div",{staticClass:"message-right"},[s("div",{staticClass:"message-header"},[s("div",{staticClass:"message-title"},[e._v(" "+e._s(t[1].chatName)+" ")]),s("div",{staticClass:"message-time"},[e._v(" "+e._s(e.formatTime(t[1]))+" ")])]),s("div",{staticClass:"message-content",domProps:{innerHTML:e._s(e.newMessage(t[1]))}})])])})),0)},I=[],D=function(e){Object(_["a"])(s,e);var t=Object(y["a"])(s);function s(){return Object(h["a"])(this,s),t.apply(this,arguments)}return Object(m["a"])(s,[{key:"concats",get:function(){return this.$store.state.chats}},{key:"avatar",value:function(e,t){return 0===t?"https://v2.nonebot.dev/logo.png":"friend"===e?"http://q1.qlogo.cn/g?b=qq&nk="+t.toString()+"&s=640":"http://p.qlogo.cn/gh/"+t+"/"+t+"/0"}},{key:"newMessage",value:function(e){return e.messages[e.messages.length-1]?e.messages[e.messages.length-1].raw_message:""}},{key:"switchChat",value:function(e){this.$store.commit("switchChat",e),this.$forceUpdate(),Object(v["a"])(Object(b["a"])(s.prototype),"$gotoBottom",this)}},{key:"formatTime",value:function(e){var t;if(!e.messages[0])return"-:-";t=e.messages[0].time;var s,a=new Date(t),n=a.getHours(),i=a.getMinutes(),o="";return s=n<10?"0".concat(n):n.toString(),o=i<10?"0".concat(i):i.toString(),s+":"+o}}]),s}(C["b"]);D=Object(w["a"])([Object(C["a"])({name:"ChatList"})],D);var L=D,z=L,F=(s("eab5"),Object(c["a"])(z,H,I,!1,null,"2d2cff13",null)),K=F.exports,R=function(e){Object(_["a"])(s,e);var t=Object(y["a"])(s);function s(){return Object(h["a"])(this,s),t.apply(this,arguments)}return Object(m["a"])(s,[{key:"getActivingTitle",get:function(){return this.$store.getters.activingChat.chatName}},{key:"created",value:function(){Object(v["a"])(Object(b["a"])(s.prototype),"$socket",this).connect()}}]),s}(C["b"]);R=Object(w["a"])([Object(C["a"])({name:"Dialogue",components:{Messages:S,Sender:q,ChatList:K}})],R);var U=R,J=U,W=(s("2382"),Object(c["a"])(J,d,p,!1,null,"2c96dcc7",null)),X=W.exports,G=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"about"},[s("h1",{on:{click:e.toastr_test}},[e._v("This is an about page")])])},Q=[],V=function(e){Object(_["a"])(s,e);var t=Object(y["a"])(s);function s(){return Object(h["a"])(this,s),t.apply(this,arguments)}return s}(C["b"]),Y=V,Z=Object(c["a"])(Y,G,Q,!1,null,null,null),ee=Z.exports;a["default"].use(f["a"]);var te=[{path:"/",name:"Home",component:X},{path:"/about",name:"About",component:ee}],se=new f["a"]({mode:"history",base:"/web/",routes:te}),ae=se,ne=(s("4ec9"),s("3ca3"),s("ddb0"),s("2f62"));a["default"].use(ne["a"]);var ie={state:{envs:{self_id:-1,access_token:"",bot_id:-1},chats:new Map([[0,{user_id:0,active:!0,chatName:"NoneBotWeb",avatar:"https://v2.nonebot.dev/logo.png",type:"",messages:[{user_id:0,self_id:-1,post_type:"",message_type:"",raw_message:"本项目仅做技术讨论之用。\n本项目不具备任何发送消息功能。\n请在下方输入bot_id开始监听（视奸）",time:(new Date).getTime(),sender:{user_id:0,nickname:"NoneBotWeb",sex:"Bot",age:0}}],newMessageCount:0,hadNewMessage:!1}]]),activingChatNumber:0},getters:{activingChat:function(e){var t=e.chats.get(e.activingChatNumber);return void 0===t?(console.log("activingChat get error"),t):t}},mutations:{delAllChats:function(e){var t=e.chats.get(0);e.chats.clear(),e.chats.set(0,t)},setBot_id:function(e,t){e.envs.bot_id=t},delChat:function(e,t){e.chats.delete(t)},switchChat:function(e,t){var s=e.chats.get(t);if(s.hadNewMessage=!1,s.newMessageCount=0,s){s.active=!0,e.chats.set(t,s);var a=e.chats.get(e.activingChatNumber);a&&(a.active=!1,e.chats.set(e.activingChatNumber,a),e.activingChatNumber=t)}},checkChat:function(e,t){var s={user_id:t.id,active:!1,type:t.sub_type,chatName:t.chatName,avatar:"",messages:[],newMessageCount:0,hadNewMessage:!1};e.chats.set(t.id,s)},newMessage:function(e,t){var s={message_type:t.sub_type,raw_message:t.raw_message,user_id:t.user_id,time:t.time,self_id:t.self_id,post_type:t.post_type,sender:{user_id:t.sender.user_id,nickname:t.sender.nickname,sex:t.sender.sex,age:t.sender.age}},a=e.chats,n=a.get(t.id);n.messages.push(s),a.delete(t.id),n.active||(n.hadNewMessage=!0,n.newMessageCount+=1),a.set(t.id,n),e.chats=new Map,e.chats=a,console.log(e.chats)}},actions:{SOCKET_event:function(e,t){var s=e.commit,a=e.rootState;a.chats.get(t.id)||s("checkChat",t),s("newMessage",t)}},modules:{}},oe=new ne["a"].Store(ie),re={install:function(e){Object.defineProperties(e.prototype,{$gotoBottom:{get:function(){var e=document.getElementsByClassName("messages-box")[0];this.$nextTick((function(){e.scrollTop=e.scrollHeight}))}},gotoBottom:{get:function(){var e=document.getElementsByClassName("messages-box")[0];this.$nextTick((function(){e.scrollTop=e.scrollHeight}))}}})}},ce=re,ue=s("5132"),le=s.n(ue),ge=function(e){return a["default"].use(new le.a({debug:!1,connection:"/",vuex:{store:e,actionPrefix:"SOCKET_",mutationPrefix:"SOCKET_"},options:{path:"/web_ws/socket",autoConnect:!1,transportOptions:{polling:{extraHeaders:{Authorization:e.state.envs.access_token,"X-Self-ID":e.state.envs.self_id}}}}}))},fe=(s("0fae"),s("5c96")),de=s.n(fe);a["default"].use(ce),ge(oe),a["default"].use(de.a),a["default"].config.productionTip=!1,new a["default"]({router:ae,store:oe,render:function(e){return e(l)}}).$mount("#app")},eab5:function(e,t,s){"use strict";s("7914")},fa6d:function(e,t,s){"use strict";s("73c7")}});
//# sourceMappingURL=app.e50a93e2.js.map